{"ast":null,"code":"import _regeneratorRuntime from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import useEth from\"../contexts/EthContext/useEth\";import Axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var serverUrl='http://localhost:3000/deliveries/';var userAddress=null;var listeningToAllegeEvent=false;var listeningToAcceptEvent=false;var RequestDelivery=function RequestDelivery(){var _useEth=useEth(),_useEth$state=_useEth.state,contract=_useEth$state.contract,accounts=_useEth$state.accounts;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),requests=_useState2[0],setRequests=_useState2[1];useEffect(function(){if(accounts!=null){userAddress=accounts[0];}if(userAddress!=null){Axios.get(serverUrl+'address/'+userAddress).then(function(response){setRequests(response.data);});}},[contract]);var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),to=_useState4[0],setTo=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),from=_useState6[0],setFrom=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),item=_useState8[0],setItem=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),value=_useState10[0],setValue=_useState10[1];window.allegeEvent=null;// starting listener for Accept Event.\nif(contract!=null&&!listeningToAcceptEvent){window.acceptEvent=contract.events.AcceptEvent().on(\"data\",function(log){handleAccept(log);});listeningToAcceptEvent=true;}// starting listener for Allege Event.\nif(contract!=null&&!listeningToAllegeEvent){window.allegeEvent=contract.events.AllegeEvent().on(\"data\",function(log){handleAllege(log);});listeningToAllegeEvent=true;}var handleInput=function handleInput(e){switch(e.target.name){case'to':setTo(e.target.value);break;case'from':setFrom(e.target.value);break;case'item':setItem(e.target.value);break;case'value':setValue(e.target.value);break;default:alert('Invalid input source.');break;}};var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(to===''||from===''||item===''||value===0)){_context.next=3;break;}alert(\"Please fill in all the values.\");return _context.abrupt(\"return\");case 3:_context.next=5;return contract.methods.requestDelivery(to,from,item).send({from:accounts[0],value:value}).then(function(response){console.log(response);var tempArray=requests;tempArray.push(response.events.RequestEvent.returnValues.requestId);setRequests(tempArray);});case 5:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(){return _ref.apply(this,arguments);};}();window.handleConfirm=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(index){var requestId;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:requestId=requests[index]._id;_context2.next=3;return contract.methods.confirm(requestId).send({from:accounts[0]});case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}();var handleAccept=function handleAccept(log){var requestId=log.returnValues.requestId;requests.forEach(function(request,index){if(request._id==requestId){requests[index].status=1;requests[index].deliveryMan=log.returnValues.deliveryMan;return;}});};var handleAllege=function handleAllege(log){var requestId=log.returnValues.requestId;requests.forEach(function(request,index){if(request._id==requestId){requests[index].status=2;return;}});};return/*#__PURE__*/_jsxs(\"div\",{id:\"wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Request a Delivery\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"to\",children:\"Delivery Destination: \"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"to\",onChange:handleInput}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"from\",children:\"Pickup From: \"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"from\",onChange:handleInput}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"item\",children:\"Pick this up: \"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"item\",onChange:handleInput}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"value\",children:\"Attach payment(in wei): \"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"value\",onChange:handleInput}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmit,children:\"Submit\"})]}),/*#__PURE__*/_jsxs(\"table\",{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Item\"}),/*#__PURE__*/_jsx(\"th\",{children:\"From\"}),/*#__PURE__*/_jsx(\"th\",{children:\"To\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:requests!=null?requests.map(function(request,index){console.log(request.status);return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:request.item}),/*#__PURE__*/_jsx(\"td\",{children:request.from}),/*#__PURE__*/_jsx(\"td\",{children:request.to}),/*#__PURE__*/_jsx(\"td\",{children:request.status==\"0\"?\"Requested\":request.status=='1'?\"on the way\":request.status=='2'?/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return window.handleConfirm(index);},children:\"Confirm\"}):\"Completed.\"})]});}):\"You have not requestsed anything yet.\"})]})]});};export default RequestDelivery;","map":{"version":3,"names":["React","useState","useEffect","useEth","Axios","serverUrl","userAddress","listeningToAllegeEvent","listeningToAcceptEvent","RequestDelivery","state","contract","accounts","requests","setRequests","get","then","response","data","to","setTo","from","setFrom","item","setItem","value","setValue","window","allegeEvent","acceptEvent","events","AcceptEvent","on","log","handleAccept","AllegeEvent","handleAllege","handleInput","e","target","name","alert","handleSubmit","methods","requestDelivery","send","console","tempArray","push","RequestEvent","returnValues","requestId","handleConfirm","index","_id","confirm","forEach","request","status","deliveryMan","map"],"sources":["D:/Kapil D/Personal/DecentralizedDeliveries/client/src/components/RequestDelivery.jsx"],"sourcesContent":["import React, {useState, useEffect} from 'react'\r\nimport useEth from \"../contexts/EthContext/useEth\";\r\nimport Axios from 'axios'\r\n\r\nconst serverUrl = 'http://localhost:3000/deliveries/'\r\nlet userAddress = null;\r\n\r\nlet listeningToAllegeEvent = false;\r\nlet listeningToAcceptEvent = false;\r\n\r\nconst RequestDelivery = () => {\r\n  const { state: { contract, accounts } } = useEth();\r\n  const [requests, setRequests] = useState([])\r\n\r\nuseEffect(() => {\r\n  if(accounts != null) {\r\n    userAddress = accounts[0]\r\n  }\r\n  if(userAddress != null) {\r\n    Axios.get(serverUrl+'address/' + userAddress).then(response => {\r\n      setRequests(response.data)\r\n    })\r\n  }\r\n}, [contract])\r\n\r\n  const [to, setTo] = useState('')\r\n  const [from, setFrom] = useState('')\r\n  const [item, setItem] = useState('')\r\n  const [value, setValue] = useState(0)\r\n  window.allegeEvent = null;\r\n\r\n\r\n  // starting listener for Accept Event.\r\n  if (contract != null && !listeningToAcceptEvent) {\r\n    window.acceptEvent = contract.events.AcceptEvent()\r\n    .on(\"data\", function(log) {\r\n      handleAccept(log);\r\n    })\r\n    listeningToAcceptEvent = true;\r\n  }\r\n\r\n  // starting listener for Allege Event.\r\n  if (contract != null && !listeningToAllegeEvent) {\r\n    window.allegeEvent = contract.events.AllegeEvent()\r\n    .on(\"data\", function(log) {\r\n      handleAllege(log);\r\n    })\r\n    listeningToAllegeEvent = true;\r\n  }\r\n\r\n  const handleInput = e => {\r\n    switch(e.target.name) {\r\n        case 'to': \r\n            setTo(e.target.value);\r\n            break;\r\n        case 'from':\r\n            setFrom(e.target.value);\r\n            break;\r\n        case 'item': \r\n            setItem(e.target.value);\r\n            break;\r\n        case 'value': \r\n            setValue(e.target.value);\r\n            break;\r\n        default: \r\n            alert('Invalid input source.')\r\n            break;\r\n    }\r\n  }\r\n\r\n  const handleSubmit = async () => {\r\n    // Validation: \r\n    if (to === '' || from === '' || item === '' || value === 0) {\r\n        alert(\"Please fill in all the values.\")\r\n        return;\r\n    }\r\n\r\n    // Calling Contract if validation succeeds: \r\n    await contract.methods.requestDelivery(to, from, item).send({from: accounts[0], value: value}).then((response) => {\r\n      console.log(response)\r\n      let tempArray = requests\r\n      tempArray.push(response.events.RequestEvent.returnValues.requestId)\r\n      setRequests(tempArray)\r\n    })\r\n  }\r\n\r\n  window.handleConfirm = async (index) => {\r\n    let requestId = requests[index]._id\r\n    await contract.methods.confirm(requestId).send({from: accounts[0]})\r\n  }\r\n\r\n  const handleAccept = (log) => {\r\n    let requestId = log.returnValues.requestId\r\n    requests.forEach((request, index) => {\r\n      if (request._id == requestId) {\r\n        requests[index].status = 1\r\n        requests[index].deliveryMan = log.returnValues.deliveryMan\r\n        return;\r\n      }\r\n    }) \r\n  }\r\n\r\n  const handleAllege = (log) => {\r\n    let requestId = log.returnValues.requestId\r\n    requests.forEach((request, index) => {\r\n      if (request._id == requestId) {\r\n        requests[index].status = 2\r\n        return;\r\n      }\r\n    }) \r\n  }\r\n\r\n  return (\r\n    <div id='wrapper'>\r\n      <div>\r\n        <h1>Request a Delivery</h1>\r\n        <label htmlFor=\"to\">Delivery Destination: </label>\r\n        <input type=\"text\" name='to' onChange={handleInput}/>\r\n\r\n        <label htmlFor=\"from\">Pickup From: </label>\r\n        <input type=\"text\" name='from' onChange={handleInput}/>\r\n\r\n        <label htmlFor=\"item\">Pick this up: </label>\r\n        <input type=\"text\" name='item' onChange={handleInput} />\r\n\r\n        <label htmlFor=\"value\">Attach payment(in wei): </label>\r\n        <input type=\"number\" name='value' onChange={handleInput} />\r\n\r\n        <button onClick={handleSubmit}>Submit</button>\r\n      </div>\r\n\r\n      <table>\r\n        <thead>\r\n          <tr>\r\n            <th>Item</th>\r\n            <th>From</th>\r\n            <th>To</th>\r\n            <th>Status</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {requests != null ? requests.map((request, index) => {\r\n            console.log(request.status)\r\n            return (\r\n              <tr>\r\n              <td>{request.item}</td>\r\n              <td>{request.from}</td>\r\n              <td>{request.to}</td>\r\n              <td>{request.status == \"0\" ? \"Requested\" : request.status == '1' ? \"on the way\" : request.status == '2' ? <button onClick={() => window.handleConfirm(index)}>Confirm</button> : \"Completed.\"}</td>\r\n            </tr>\r\n            )\r\n          }): \"You have not requestsed anything yet.\"}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default RequestDelivery"],"mappings":"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"},"metadata":{},"sourceType":"module"}