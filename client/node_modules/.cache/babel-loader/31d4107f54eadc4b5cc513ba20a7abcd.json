{"ast":null,"code":"import _regeneratorRuntime from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useReducer,useCallback,useEffect}from\"react\";import Web3 from\"web3\";import EthContext from\"./EthContext\";import{reducer,actions,initialState}from\"./state\";import{jsx as _jsx}from\"react/jsx-runtime\";function EthProvider(_ref){var children=_ref.children;var _useReducer=useReducer(reducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var init=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(artifact){var web3,accounts,networkID,abi,address,contract;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!artifact){_context.next=12;break;}web3=new Web3(Web3.givenProvider||\"ws://localhost:7545\");_context.next=4;return web3.eth.requestAccounts();case 4:accounts=_context.sent;_context.next=7;return web3.eth.net.getId();case 7:networkID=_context.sent;console.log(networkID);abi=artifact.abi;try{address=artifact.networks[networkID].address;contract=new web3.eth.Contract(abi,address);}catch(err){console.error(err);}dispatch({type:actions.init,data:{artifact:artifact,web3:web3,accounts:accounts,networkID:networkID,contract:contract}});case 12:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}(),[]);useEffect(function(){var tryInit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var artifact;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:try{artifact=require(\"../../contracts/DeliveryHandler.json\");init(artifact);}catch(err){console.error(err);}case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function tryInit(){return _ref3.apply(this,arguments);};}();tryInit();},[init]);useEffect(function(){var events=[\"chainChanged\",\"accountsChanged\"];var handleChange=function handleChange(){init(state.artifact);};events.forEach(function(e){return window.ethereum.on(e,handleChange);});return function(){events.forEach(function(e){return window.ethereum.removeListener(e,handleChange);});};},[init,state.artifact]);return/*#__PURE__*/_jsx(EthContext.Provider,{value:{state:state,dispatch:dispatch},children:children});}export default EthProvider;","map":{"version":3,"names":["React","useReducer","useCallback","useEffect","Web3","EthContext","reducer","actions","initialState","EthProvider","children","state","dispatch","init","artifact","web3","givenProvider","eth","requestAccounts","accounts","net","getId","networkID","console","log","abi","address","networks","contract","Contract","err","error","type","data","tryInit","require","events","handleChange","forEach","e","window","ethereum","on","removeListener"],"sources":["D:/Kapil D/Personal/DecentralizedDeliveries/client/src/contexts/EthContext/EthProvider.jsx"],"sourcesContent":["import React, { useReducer, useCallback, useEffect } from \"react\";\nimport Web3 from \"web3\";\nimport EthContext from \"./EthContext\";\nimport { reducer, actions, initialState } from \"./state\";\n\nfunction EthProvider({ children }) {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  const init = useCallback(\n    async artifact => {\n      if (artifact) {\n        const web3 = new Web3(Web3.givenProvider || \"ws://localhost:7545\");\n        const accounts = await web3.eth.requestAccounts();\n        const networkID = await web3.eth.net.getId();\n        console.log(networkID);\n        const { abi } = artifact;\n        let address, contract;\n        try {\n          address = artifact.networks[networkID].address;\n          contract = new web3.eth.Contract(abi, address);\n        } catch (err) {\n          console.error(err);\n        }\n        dispatch({\n          type: actions.init,\n          data: { artifact, web3, accounts, networkID, contract }\n        });\n      }\n    }, []);\n\n  useEffect(() => {\n    const tryInit = async () => {\n      try {\n        const artifact = require(\"../../contracts/DeliveryHandler.json\");\n        init(artifact);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    tryInit();\n  }, [init]);\n\n  useEffect(() => {\n    const events = [\"chainChanged\", \"accountsChanged\"];\n    const handleChange = () => {\n      init(state.artifact);\n    };\n\n    events.forEach(e => window.ethereum.on(e, handleChange));\n    return () => {\n      events.forEach(e => window.ethereum.removeListener(e, handleChange));\n    };\n  }, [init, state.artifact]);\n\n  return (\n    <EthContext.Provider value={{\n      state,\n      dispatch\n    }}>\n      {children}\n    </EthContext.Provider>\n  );\n}\n\nexport default EthProvider;\n"],"mappings":"waAAA,MAAOA,MAAP,EAAgBC,UAAhB,CAA4BC,WAA5B,CAAyCC,SAAzC,KAA0D,OAA1D,CACA,MAAOC,KAAP,KAAiB,MAAjB,CACA,MAAOC,WAAP,KAAuB,cAAvB,CACA,OAASC,OAAT,CAAkBC,OAAlB,CAA2BC,YAA3B,KAA+C,SAA/C,C,2CAEA,QAASC,YAAT,MAAmC,IAAZC,SAAY,MAAZA,QAAY,CACjC,gBAA0BT,UAAU,CAACK,OAAD,CAAUE,YAAV,CAApC,4CAAOG,KAAP,iBAAcC,QAAd,iBAEA,GAAMC,KAAI,CAAGX,WAAW,6FACtB,iBAAMY,QAAN,yKACMA,QADN,0BAEUC,IAFV,CAEiB,GAAIX,KAAJ,CAASA,IAAI,CAACY,aAAL,EAAsB,qBAA/B,CAFjB,uBAG2BD,KAAI,CAACE,GAAL,CAASC,eAAT,EAH3B,QAGUC,QAHV,qCAI4BJ,KAAI,CAACE,GAAL,CAASG,GAAT,CAAaC,KAAb,EAJ5B,QAIUC,SAJV,eAKIC,OAAO,CAACC,GAAR,CAAYF,SAAZ,EACQG,GANZ,CAMoBX,QANpB,CAMYW,GANZ,CAQI,GAAI,CACFC,OAAO,CAAGZ,QAAQ,CAACa,QAAT,CAAkBL,SAAlB,EAA6BI,OAAvC,CACAE,QAAQ,CAAG,GAAIb,KAAI,CAACE,GAAL,CAASY,QAAb,CAAsBJ,GAAtB,CAA2BC,OAA3B,CAAX,CACD,CAAC,MAAOI,GAAP,CAAY,CACZP,OAAO,CAACQ,KAAR,CAAcD,GAAd,EACD,CACDlB,QAAQ,CAAC,CACPoB,IAAI,CAAEzB,OAAO,CAACM,IADP,CAEPoB,IAAI,CAAE,CAAEnB,QAAQ,CAARA,QAAF,CAAYC,IAAI,CAAJA,IAAZ,CAAkBI,QAAQ,CAARA,QAAlB,CAA4BG,SAAS,CAATA,SAA5B,CAAuCM,QAAQ,CAARA,QAAvC,CAFC,CAAD,CAAR,CAdJ,uDADsB,gEAoBnB,EApBmB,CAAxB,CAsBAzB,SAAS,CAAC,UAAM,CACd,GAAM+B,QAAO,6FAAG,uJACd,GAAI,CACIpB,QADJ,CACeqB,OAAO,CAAC,sCAAD,CADtB,CAEFtB,IAAI,CAACC,QAAD,CAAJ,CACD,CAAC,MAAOgB,GAAP,CAAY,CACZP,OAAO,CAACQ,KAAR,CAAcD,GAAd,EACD,CANa,wDAAH,kBAAPI,QAAO,2CAAb,CASAA,OAAO,GACR,CAXQ,CAWN,CAACrB,IAAD,CAXM,CAAT,CAaAV,SAAS,CAAC,UAAM,CACd,GAAMiC,OAAM,CAAG,CAAC,cAAD,CAAiB,iBAAjB,CAAf,CACA,GAAMC,aAAY,CAAG,QAAfA,aAAe,EAAM,CACzBxB,IAAI,CAACF,KAAK,CAACG,QAAP,CAAJ,CACD,CAFD,CAIAsB,MAAM,CAACE,OAAP,CAAe,SAAAC,CAAC,QAAIC,OAAM,CAACC,QAAP,CAAgBC,EAAhB,CAAmBH,CAAnB,CAAsBF,YAAtB,CAAJ,EAAhB,EACA,MAAO,WAAM,CACXD,MAAM,CAACE,OAAP,CAAe,SAAAC,CAAC,QAAIC,OAAM,CAACC,QAAP,CAAgBE,cAAhB,CAA+BJ,CAA/B,CAAkCF,YAAlC,CAAJ,EAAhB,EACD,CAFD,CAGD,CAVQ,CAUN,CAACxB,IAAD,CAAOF,KAAK,CAACG,QAAb,CAVM,CAAT,CAYA,mBACE,KAAC,UAAD,CAAY,QAAZ,EAAqB,KAAK,CAAE,CAC1BH,KAAK,CAALA,KAD0B,CAE1BC,QAAQ,CAARA,QAF0B,CAA5B,UAIGF,QAJH,EADF,CAQD,CAED,cAAeD,YAAf"},"metadata":{},"sourceType":"module"}