{"ast":null,"code":"var _jsxFileName = \"D:\\\\Kapil D\\\\Personal\\\\DecentralizedDeliveries\\\\client\\\\src\\\\components\\\\ProclaimDelivery.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport useEth from \"../contexts/EthContext/useEth\";\nimport Axios from 'axios';\nimport '../App.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nrequire('dotenv').config();\n\nconst serverUrl = \"http://localhost:3000\" + '/deliveries/';\nlet userAddress = null;\nlet listeningToCompleteEvent = false;\n\nconst ProclaimDelivery = _ref => {\n  _s();\n\n  let {\n    setMining\n  } = _ref;\n  const {\n    state: {\n      contract,\n      accounts\n    }\n  } = useEth();\n  const [deliveryRequests, setDeliveryRequests] = useState([]);\n\n  if (accounts != null) {\n    userAddress = accounts[0];\n  }\n\n  if (userAddress != null) {\n    Axios.get(serverUrl + 'deliveryMan/' + userAddress).then(response => {\n      setDeliveryRequests(response.data);\n    });\n  }\n\n  const handleComplete = log => {\n    let requestId = log.returnValues.requestId;\n    let tempRequests = deliveryRequests;\n    tempRequests.forEach((request, index) => {\n      if (request._id == requestId) {\n        alert(\"The Delivery has been confirmed. The reward has been transferred to your account.\");\n      }\n    });\n  }; // starting listener for Confirmation Event.\n\n\n  if (contract != null && !listeningToCompleteEvent) {\n    window.completeEvent = contract.events.CompleteEvent().on(\"data\", function (log) {\n      handleComplete(log);\n    });\n    listeningToCompleteEvent = true;\n  }\n\n  const proclaimDelivery = async index => {\n    const hash = deliveryRequests[index]._id;\n\n    if (hash === '') {\n      alert('There was some problem. Please try again.');\n      return;\n    }\n\n    setMining(true);\n\n    try {\n      await contract.methods.allegeDelivery(hash).send({\n        from: accounts[0]\n      }).then(response => {\n        console.log(response);\n        alert(\"Waiting for confirmation from customer. Money will be transferred to your account after confirmation.\");\n      });\n    } catch (err) {\n      alert(err);\n    }\n\n    setMining(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"wrapper\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Proclaim your delivery\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n      id: \"deliveries\",\n      children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n        children: /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: [/*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Index\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 69,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Item\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Pickup From\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 71,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Deliver To\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 72,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Reward\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 73,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Accept Delivery\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 74,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n        children: deliveryRequests != null ? deliveryRequests.map((req, index) => {\n          return /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              children: index + 1\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 81,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: req.item\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 82,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: req.from\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 83,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: req.to\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 84,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: req.payment\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 85,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => proclaimDelivery(index),\n                children: \"Proclaim\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 86,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 86,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 15\n          }, this);\n        }) : console.log(\"deliveryRequests was null.\")\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 9\n    }, this), deliveryRequests != null ? deliveryRequests.length == 0 ? \"No delivery requests yet.\" : null : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this);\n};\n\n_s(ProclaimDelivery, \"sqrS6pPbcQXNP83tWXXkIRlNTCc=\", false, function () {\n  return [useEth];\n});\n\n_c = ProclaimDelivery;\nexport default ProclaimDelivery;\n\nvar _c;\n\n$RefreshReg$(_c, \"ProclaimDelivery\");","map":{"version":3,"names":["React","useState","useEth","Axios","require","config","serverUrl","userAddress","listeningToCompleteEvent","ProclaimDelivery","setMining","state","contract","accounts","deliveryRequests","setDeliveryRequests","get","then","response","data","handleComplete","log","requestId","returnValues","tempRequests","forEach","request","index","_id","alert","window","completeEvent","events","CompleteEvent","on","proclaimDelivery","hash","methods","allegeDelivery","send","from","console","err","map","req","item","to","payment","length"],"sources":["D:/Kapil D/Personal/DecentralizedDeliveries/client/src/components/ProclaimDelivery.jsx"],"sourcesContent":["import React, {useState} from 'react'\r\nimport useEth from \"../contexts/EthContext/useEth\";\r\nimport Axios from 'axios'\r\nimport '../App.css'\r\nrequire('dotenv').config()\r\n\r\n\r\nconst serverUrl = \"http://localhost:3000\" + '/deliveries/'\r\nlet userAddress = null;\r\nlet listeningToCompleteEvent = false;\r\n\r\nconst ProclaimDelivery = ({ setMining }) => {\r\n  \r\n    const { state: { contract, accounts } } = useEth();\r\n    const [deliveryRequests, setDeliveryRequests] = useState([])\r\n    if(accounts != null) {\r\n      userAddress = accounts[0]\r\n    }\r\n\r\n    if(userAddress != null) {\r\n      Axios.get(serverUrl+'deliveryMan/' + userAddress).then(response => {\r\n        setDeliveryRequests(response.data)\r\n      })\r\n    }\r\n\r\n    const handleComplete = (log) => {\r\n      let requestId = log.returnValues.requestId\r\n      let tempRequests = deliveryRequests\r\n      tempRequests.forEach((request, index) => {\r\n        if (request._id == requestId) {\r\n          alert(\"The Delivery has been confirmed. The reward has been transferred to your account.\")\r\n        }\r\n      }) \r\n    }\r\n\r\n    // starting listener for Confirmation Event.\r\n    if (contract != null && !listeningToCompleteEvent) {\r\n      window.completeEvent = contract.events.CompleteEvent()\r\n      .on(\"data\", function(log) {\r\n        handleComplete(log);\r\n      })\r\n      listeningToCompleteEvent = true;\r\n    }\r\n\r\n    const proclaimDelivery = async (index) => {\r\n      const hash = deliveryRequests[index]._id\r\n      if(hash === '') {\r\n        alert('There was some problem. Please try again.');\r\n        return;\r\n      }\r\n      setMining(true)\r\n      try {\r\n        await contract.methods.allegeDelivery(hash).send({from: accounts[0]}).then((response) => {\r\n          console.log(response)\r\n          alert(\"Waiting for confirmation from customer. Money will be transferred to your account after confirmation.\")\r\n        })\r\n      } catch(err) {\r\n        alert(err)\r\n      }\r\n      setMining(false)\r\n    }\r\n\r\n  return (\r\n    <div id='wrapper'>\r\n        <h2>Proclaim your delivery</h2>\r\n        <table id='deliveries'>\r\n          <thead>\r\n            <tr>\r\n              <th>Index</th>\r\n              <th>Item</th>\r\n              <th>Pickup From</th>\r\n              <th>Deliver To</th>\r\n              <th>Reward</th>\r\n              <th>Accept Delivery</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n          {deliveryRequests != null ? deliveryRequests.map((req, index) =>  {\r\n            return (\r\n              <tr>\r\n                <td>{index+1}</td>\r\n                <td>{req.item}</td>\r\n                <td>{req.from}</td>\r\n                <td>{req.to}</td>\r\n                <td>{req.payment}</td>\r\n                <td><button onClick={() => proclaimDelivery(index)}>Proclaim</button></td>\r\n              </tr>\r\n            )\r\n          }): console.log(\"deliveryRequests was null.\")}\r\n          </tbody>\r\n        </table>\r\n        {deliveryRequests != null ? deliveryRequests.length == 0 ? \"No delivery requests yet.\" : null : null}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ProclaimDelivery"],"mappings":"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"},"metadata":{},"sourceType":"module"}