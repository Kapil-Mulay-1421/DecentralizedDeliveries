{"ast":null,"code":"import _regeneratorRuntime from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useRef,useState}from'react';import useEth from\"../contexts/EthContext/useEth\";import Axios from'axios';import'../App.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";require('dotenv').config();var serverUrl=\"http://localhost:3000\"+'/deliveries/';var userAddress=null;var AcceptDelivery=function AcceptDelivery(_ref){var setMining=_ref.setMining;var _useEth=useEth(),_useEth$state=_useEth.state,contract=_useEth$state.contract,accounts=_useEth$state.accounts;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),deliveryRequests=_useState2[0],setDeliveryRequests=_useState2[1];if(accounts!=null){userAddress=accounts[0];}if(userAddress!=null){Axios.get(serverUrl+'stage/0').then(function(response){setDeliveryRequests(response.data);});}var acceptDelivery=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(index){var hash;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:hash=deliveryRequests[index]._id;if(!(hash==='')){_context.next=4;break;}alert('There was a problem, please try again.');return _context.abrupt(\"return\");case 4:// showing shadowLayer\nsetMining(true);_context.prev=5;_context.next=8;return contract.methods.acceptDelivery(hash).send({from:accounts[0]}).then(function(response){console.log(response);alert(\"Accepted request. Head over to the Proclaims page once you make the delivery.\");});case 8:_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](5);alert(_context.t0);case 13:setMining(false);case 14:case\"end\":return _context.stop();}}},_callee,null,[[5,10]]);}));return function acceptDelivery(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{id:\"wrapper\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Make a Delivery\"}),/*#__PURE__*/_jsxs(\"table\",{id:\"deliveries\",children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Index\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Item\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Pickup From\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Deliver To\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Reward(in wei)\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Accept Delivery\"})]}),deliveryRequests!=null?deliveryRequests.map(function(req,index){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:index+1}),/*#__PURE__*/_jsx(\"td\",{children:req.item}),/*#__PURE__*/_jsx(\"td\",{children:req.from}),/*#__PURE__*/_jsx(\"td\",{children:req.to}),/*#__PURE__*/_jsx(\"td\",{children:req.payment}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return acceptDelivery(index);},children:\"Accept\"})})]});}):console.log(\"deliveryRequests was null.\")]}),deliveryRequests!=null?deliveryRequests.length==0?\"No delivery requests yet.\":null:null]});};export default AcceptDelivery;","map":{"version":3,"names":["React","useRef","useState","useEth","Axios","require","config","serverUrl","userAddress","AcceptDelivery","setMining","state","contract","accounts","deliveryRequests","setDeliveryRequests","get","then","response","data","acceptDelivery","index","hash","_id","alert","methods","send","from","console","log","map","req","item","to","payment","length"],"sources":["D:/Kapil D/Personal/DecentralizedDeliveries/client/src/components/AcceptDelivery.jsx"],"sourcesContent":["import React, {useRef, useState} from 'react'\r\nimport useEth from \"../contexts/EthContext/useEth\";\r\nimport Axios from 'axios'\r\nimport '../App.css'\r\nrequire('dotenv').config()\r\n\r\n\r\nconst serverUrl = \"http://localhost:3000\" + '/deliveries/'\r\nlet userAddress = null;\r\n\r\nconst AcceptDelivery = ({ setMining }) => {\r\n  \r\n    const { state: { contract, accounts } } = useEth()\r\n    const [deliveryRequests, setDeliveryRequests] = useState([])\r\n    if(accounts != null) {\r\n      userAddress = accounts[0]\r\n    }\r\n\r\n    if(userAddress != null) {\r\n      Axios.get(serverUrl+'stage/0').then(response => {\r\n        setDeliveryRequests(response.data)\r\n      })\r\n    }\r\n\r\n    const acceptDelivery = async (index) => {\r\n      const hash = deliveryRequests[index]._id\r\n      if(hash === '') {\r\n        alert('There was a problem, please try again.');\r\n        return;\r\n      }\r\n      // showing shadowLayer\r\n      setMining(true)\r\n      try {\r\n        await contract.methods.acceptDelivery(hash).send({from: accounts[0]}).then((response) => {\r\n          console.log(response)\r\n          alert(\"Accepted request. Head over to the Proclaims page once you make the delivery.\")\r\n        })\r\n      } catch(err) {\r\n        alert(err)\r\n      }\r\n      setMining(false)\r\n    }\r\n\r\n  return (\r\n    <div id='wrapper'>\r\n        <h2>Make a Delivery</h2>\r\n        <table id='deliveries'>\r\n          <tr>\r\n            <th>Index</th>\r\n            <th>Item</th>\r\n            <th>Pickup From</th>\r\n            <th>Deliver To</th>\r\n            <th>Reward(in wei)</th>\r\n            <th>Accept Delivery</th>\r\n          </tr>\r\n          {deliveryRequests != null ? deliveryRequests.map((req, index) =>  {\r\n            return (\r\n              <tr>\r\n                <td>{index+1}</td>\r\n                <td>{req.item}</td>\r\n                <td>{req.from}</td>\r\n                <td>{req.to}</td>\r\n                <td>{req.payment}</td>\r\n                <td><button onClick={() => acceptDelivery(index)}>Accept</button></td>\r\n              </tr>\r\n            )\r\n          }): console.log(\"deliveryRequests was null.\")}\r\n        </table>\r\n        {deliveryRequests != null ? deliveryRequests.length == 0 ? \"No delivery requests yet.\" : null : null}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default AcceptDelivery"],"mappings":"waAAA,MAAOA,MAAP,EAAeC,MAAf,CAAuBC,QAAvB,KAAsC,OAAtC,CACA,MAAOC,OAAP,KAAmB,+BAAnB,CACA,MAAOC,MAAP,KAAkB,OAAlB,CACA,MAAO,YAAP,C,wFACAC,OAAO,CAAC,QAAD,CAAP,CAAkBC,MAAlB,GAGA,GAAMC,UAAS,CAAG,wBAA0B,cAA5C,CACA,GAAIC,YAAW,CAAG,IAAlB,CAEA,GAAMC,eAAc,CAAG,QAAjBA,eAAiB,MAAmB,IAAhBC,UAAgB,MAAhBA,SAAgB,CAEtC,YAA0CP,MAAM,EAAhD,uBAAQQ,KAAR,CAAiBC,QAAjB,eAAiBA,QAAjB,CAA2BC,QAA3B,eAA2BA,QAA3B,CACA,cAAgDX,QAAQ,CAAC,EAAD,CAAxD,wCAAOY,gBAAP,eAAyBC,mBAAzB,eACA,GAAGF,QAAQ,EAAI,IAAf,CAAqB,CACnBL,WAAW,CAAGK,QAAQ,CAAC,CAAD,CAAtB,CACD,CAED,GAAGL,WAAW,EAAI,IAAlB,CAAwB,CACtBJ,KAAK,CAACY,GAAN,CAAUT,SAAS,CAAC,SAApB,EAA+BU,IAA/B,CAAoC,SAAAC,QAAQ,CAAI,CAC9CH,mBAAmB,CAACG,QAAQ,CAACC,IAAV,CAAnB,CACD,CAFD,EAGD,CAED,GAAMC,eAAc,6FAAG,iBAAOC,KAAP,6HACfC,IADe,CACRR,gBAAgB,CAACO,KAAD,CAAhB,CAAwBE,GADhB,MAElBD,IAAI,GAAK,EAFS,0BAGnBE,KAAK,CAAC,wCAAD,CAAL,CAHmB,wCAMrB;AACAd,SAAS,CAAC,IAAD,CAAT,CAPqB,sCASbE,SAAQ,CAACa,OAAT,CAAiBL,cAAjB,CAAgCE,IAAhC,EAAsCI,IAAtC,CAA2C,CAACC,IAAI,CAAEd,QAAQ,CAAC,CAAD,CAAf,CAA3C,EAAgEI,IAAhE,CAAqE,SAACC,QAAD,CAAc,CACvFU,OAAO,CAACC,GAAR,CAAYX,QAAZ,EACAM,KAAK,CAAC,+EAAD,CAAL,CACD,CAHK,CATa,yFAcnBA,KAAK,aAAL,CAdmB,QAgBrBd,SAAS,CAAC,KAAD,CAAT,CAhBqB,qEAAH,kBAAdU,eAAc,6CAApB,CAmBF,mBACE,aAAK,EAAE,CAAC,SAAR,wBACI,uCADJ,cAEI,eAAO,EAAE,CAAC,YAAV,wBACE,mCACE,6BADF,cAEE,4BAFF,cAGE,mCAHF,cAIE,kCAJF,cAKE,sCALF,cAME,uCANF,GADF,CASGN,gBAAgB,EAAI,IAApB,CAA2BA,gBAAgB,CAACgB,GAAjB,CAAqB,SAACC,GAAD,CAAMV,KAAN,CAAiB,CAChE,mBACE,mCACE,oBAAKA,KAAK,CAAC,CAAX,EADF,cAEE,oBAAKU,GAAG,CAACC,IAAT,EAFF,cAGE,oBAAKD,GAAG,CAACJ,IAAT,EAHF,cAIE,oBAAKI,GAAG,CAACE,EAAT,EAJF,cAKE,oBAAKF,GAAG,CAACG,OAAT,EALF,cAME,iCAAI,eAAQ,OAAO,CAAE,yBAAMd,eAAc,CAACC,KAAD,CAApB,EAAjB,oBAAJ,EANF,GADF,CAUD,CAX2B,CAA3B,CAWGO,OAAO,CAACC,GAAR,CAAY,4BAAZ,CApBN,GAFJ,CAwBKf,gBAAgB,EAAI,IAApB,CAA2BA,gBAAgB,CAACqB,MAAjB,EAA2B,CAA3B,CAA+B,2BAA/B,CAA6D,IAAxF,CAA+F,IAxBpG,GADF,CA4BD,CA7DD,CA+DA,cAAe1B,eAAf"},"metadata":{},"sourceType":"module"}