{"ast":null,"code":"import _regeneratorRuntime from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useReducer,useCallback,useEffect}from\"react\";import Web3 from\"web3\";import EthContext from\"./EthContext\";import{reducer,actions,initialState}from\"./state\";import{jsx as _jsx}from\"react/jsx-runtime\";function EthProvider(_ref){var children=_ref.children;var _useReducer=useReducer(reducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var init=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(artifact){var _window,ethereum,web3,accounts,networkID,abi,address,contract;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!artifact){_context.next=16;break;}_window=window,ethereum=_window.ethereum;if(ethereum){_context.next=5;break;}alert(\"Make sure you have metamask!\");return _context.abrupt(\"return\");case 5:web3=new Web3(Web3.givenProvider||\"ws://localhost:7545\");_context.next=8;return web3.eth.requestAccounts();case 8:accounts=_context.sent;_context.next=11;return web3.eth.net.getId();case 11:networkID=_context.sent;if(networkID!=80001){alert(\"You are not connected to the Mumbai Test Network.\");}abi=artifact.abi;try{address=artifact.networks[networkID].address;contract=new web3.eth.Contract(abi,address);}catch(err){console.error(err);}dispatch({type:actions.init,data:{artifact:artifact,web3:web3,accounts:accounts,networkID:networkID,contract:contract}});case 16:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}(),[]);useEffect(function(){var tryInit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var artifact;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:try{artifact=require(\"../../contracts/DeliveryHandler.json\");init(artifact);}catch(err){console.error(err);}case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function tryInit(){return _ref3.apply(this,arguments);};}();tryInit();},[init]);useEffect(function(){var events=[\"chainChanged\",\"accountsChanged\"];var handleChange=function handleChange(){init(state.artifact);};events.forEach(function(e){return window.ethereum.on(e,handleChange);});return function(){events.forEach(function(e){return window.ethereum.removeListener(e,handleChange);});};},[init,state.artifact]);return/*#__PURE__*/_jsx(EthContext.Provider,{value:{state:state,dispatch:dispatch},children:children});}export default EthProvider;","map":{"version":3,"names":["React","useReducer","useCallback","useEffect","Web3","EthContext","reducer","actions","initialState","EthProvider","children","state","dispatch","init","artifact","window","ethereum","alert","web3","givenProvider","eth","requestAccounts","accounts","net","getId","networkID","abi","address","networks","contract","Contract","err","console","error","type","data","tryInit","require","events","handleChange","forEach","e","on","removeListener"],"sources":["D:/Kapil D/Personal/DecentralizedDeliveries/client/src/contexts/EthContext/EthProvider.jsx"],"sourcesContent":["import React, { useReducer, useCallback, useEffect } from \"react\";\nimport Web3 from \"web3\";\nimport EthContext from \"./EthContext\";\nimport { reducer, actions, initialState } from \"./state\";\n\nfunction EthProvider({ children }) {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  const init = useCallback(\n    async artifact => {\n      if (artifact) {\n        const { ethereum } = window;\n        if (!ethereum) {\n          alert(\"Make sure you have metamask!\");\n          return;\n        }\n        const web3 = new Web3(Web3.givenProvider || \"ws://localhost:7545\");\n        const accounts = await web3.eth.requestAccounts();\n        const networkID = await web3.eth.net.getId();\n        if (networkID != 80001) {\n          alert(\"You are not connected to the Mumbai Test Network.\")\n        }\n        const { abi } = artifact;\n        let address, contract;\n        try {\n          address = artifact.networks[networkID].address;\n          contract = new web3.eth.Contract(abi, address);\n        } catch (err) {\n          console.error(err);\n        }\n        dispatch({\n          type: actions.init,\n          data: { artifact, web3, accounts, networkID, contract }\n        });\n      }\n    }, []);\n\n  useEffect(() => {\n    const tryInit = async () => {\n      try {\n        const artifact = require(\"../../contracts/DeliveryHandler.json\");\n        init(artifact);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    tryInit();\n  }, [init]);\n\n  useEffect(() => {\n    const events = [\"chainChanged\", \"accountsChanged\"];\n    const handleChange = () => {\n      init(state.artifact);\n    };\n\n    events.forEach(e => window.ethereum.on(e, handleChange));\n    return () => {\n      events.forEach(e => window.ethereum.removeListener(e, handleChange));\n    };\n  }, [init, state.artifact]);\n\n  return (\n    <EthContext.Provider value={{\n      state,\n      dispatch\n    }}>\n      {children}\n    </EthContext.Provider>\n  );\n}\n\nexport default EthProvider;\n"],"mappings":"waAAA,MAAOA,MAAP,EAAgBC,UAAhB,CAA4BC,WAA5B,CAAyCC,SAAzC,KAA0D,OAA1D,CACA,MAAOC,KAAP,KAAiB,MAAjB,CACA,MAAOC,WAAP,KAAuB,cAAvB,CACA,OAASC,OAAT,CAAkBC,OAAlB,CAA2BC,YAA3B,KAA+C,SAA/C,C,2CAEA,QAASC,YAAT,MAAmC,IAAZC,SAAY,MAAZA,QAAY,CACjC,gBAA0BT,UAAU,CAACK,OAAD,CAAUE,YAAV,CAApC,4CAAOG,KAAP,iBAAcC,QAAd,iBAEA,GAAMC,KAAI,CAAGX,WAAW,6FACtB,iBAAMY,QAAN,0LACMA,QADN,kCAEyBC,MAFzB,CAEYC,QAFZ,SAEYA,QAFZ,IAGSA,QAHT,yBAIMC,KAAK,CAAC,8BAAD,CAAL,CAJN,wCAOUC,IAPV,CAOiB,GAAId,KAAJ,CAASA,IAAI,CAACe,aAAL,EAAsB,qBAA/B,CAPjB,uBAQ2BD,KAAI,CAACE,GAAL,CAASC,eAAT,EAR3B,QAQUC,QARV,sCAS4BJ,KAAI,CAACE,GAAL,CAASG,GAAT,CAAaC,KAAb,EAT5B,SASUC,SATV,eAUI,GAAIA,SAAS,EAAI,KAAjB,CAAwB,CACtBR,KAAK,CAAC,mDAAD,CAAL,CACD,CACOS,GAbZ,CAaoBZ,QAbpB,CAaYY,GAbZ,CAeI,GAAI,CACFC,OAAO,CAAGb,QAAQ,CAACc,QAAT,CAAkBH,SAAlB,EAA6BE,OAAvC,CACAE,QAAQ,CAAG,GAAIX,KAAI,CAACE,GAAL,CAASU,QAAb,CAAsBJ,GAAtB,CAA2BC,OAA3B,CAAX,CACD,CAAC,MAAOI,GAAP,CAAY,CACZC,OAAO,CAACC,KAAR,CAAcF,GAAd,EACD,CACDnB,QAAQ,CAAC,CACPsB,IAAI,CAAE3B,OAAO,CAACM,IADP,CAEPsB,IAAI,CAAE,CAAErB,QAAQ,CAARA,QAAF,CAAYI,IAAI,CAAJA,IAAZ,CAAkBI,QAAQ,CAARA,QAAlB,CAA4BG,SAAS,CAATA,SAA5B,CAAuCI,QAAQ,CAARA,QAAvC,CAFC,CAAD,CAAR,CArBJ,uDADsB,gEA2BnB,EA3BmB,CAAxB,CA6BA1B,SAAS,CAAC,UAAM,CACd,GAAMiC,QAAO,6FAAG,uJACd,GAAI,CACItB,QADJ,CACeuB,OAAO,CAAC,sCAAD,CADtB,CAEFxB,IAAI,CAACC,QAAD,CAAJ,CACD,CAAC,MAAOiB,GAAP,CAAY,CACZC,OAAO,CAACC,KAAR,CAAcF,GAAd,EACD,CANa,wDAAH,kBAAPK,QAAO,2CAAb,CASAA,OAAO,GACR,CAXQ,CAWN,CAACvB,IAAD,CAXM,CAAT,CAaAV,SAAS,CAAC,UAAM,CACd,GAAMmC,OAAM,CAAG,CAAC,cAAD,CAAiB,iBAAjB,CAAf,CACA,GAAMC,aAAY,CAAG,QAAfA,aAAe,EAAM,CACzB1B,IAAI,CAACF,KAAK,CAACG,QAAP,CAAJ,CACD,CAFD,CAIAwB,MAAM,CAACE,OAAP,CAAe,SAAAC,CAAC,QAAI1B,OAAM,CAACC,QAAP,CAAgB0B,EAAhB,CAAmBD,CAAnB,CAAsBF,YAAtB,CAAJ,EAAhB,EACA,MAAO,WAAM,CACXD,MAAM,CAACE,OAAP,CAAe,SAAAC,CAAC,QAAI1B,OAAM,CAACC,QAAP,CAAgB2B,cAAhB,CAA+BF,CAA/B,CAAkCF,YAAlC,CAAJ,EAAhB,EACD,CAFD,CAGD,CAVQ,CAUN,CAAC1B,IAAD,CAAOF,KAAK,CAACG,QAAb,CAVM,CAAT,CAYA,mBACE,KAAC,UAAD,CAAY,QAAZ,EAAqB,KAAK,CAAE,CAC1BH,KAAK,CAALA,KAD0B,CAE1BC,QAAQ,CAARA,QAF0B,CAA5B,UAIGF,QAJH,EADF,CAQD,CAED,cAAeD,YAAf"},"metadata":{},"sourceType":"module"}