{"ast":null,"code":"import _regeneratorRuntime from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/Kapil D/Personal/DecentralizedDeliveries/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState}from'react';import useEth from\"../contexts/EthContext/useEth\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var listeningToAllegeEvent=false;var listeningToAcceptEvent=false;var RequestDelivery=function RequestDelivery(){var _useEth=useEth(),_useEth$state=_useEth.state,contract=_useEth$state.contract,accounts=_useEth$state.accounts;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),to=_useState2[0],setTo=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),from=_useState4[0],setFrom=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),item=_useState6[0],setItem=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),value=_useState8[0],setValue=_useState8[1];window.allegeEvent=null;var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),requests=_useState10[0],setRequests=_useState10[1];// starting listener for Accept Event.\nif(contract!=null&&!listeningToAcceptEvent){window.acceptEvent=contract.events.AcceptEvent().on(\"data\",function(log){handleAccept(log);});listeningToAcceptEvent=true;}// starting listener for Allege Event.\nif(contract!=null&&!listeningToAllegeEvent){window.allegeEvent=contract.events.AllegeEvent().on(\"data\",function(log){handleAllege(log);});listeningToAllegeEvent=true;}var handleInput=function handleInput(e){switch(e.target.name){case'to':setTo(e.target.value);break;case'from':setFrom(e.target.value);break;case'item':setItem(e.target.value);break;case'value':setValue(e.target.value);break;default:alert('Invalid input source.');break;}};var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(to===''||from===''||item===''||value===0)){_context.next=3;break;}alert(\"Please fill in all the values.\");return _context.abrupt(\"return\");case 3:_context.next=5;return contract.methods.requestDelivery(to,from,item).send({from:accounts[0],value:value}).then(function(response){console.log(response);var tempArray=requests;tempArray.push(response.events.RequestEvent.returnValues.requestId);setRequests(tempArray);});case 5:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(){return _ref.apply(this,arguments);};}();window.handleConfirm=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(index){var requestId;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:requestId=requests[index];_context2.next=3;return contract.methods.confirm(requestId).send({from:accounts[0]});case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}();var handleAccept=function handleAccept(log){var requestId=log.returnValues.requestId;if(requests.includes(requestId)){var deliveryMan=log.returnValues.deliveryMan;document.getElementById('wrapper').insertAdjacentHTML('beforeend','<p>Request '+requestId+' has been accepted by '+deliveryMan+'</p>');}};var handleAllege=function handleAllege(log){var requestId=log.returnValues.requestId;if(requests.includes(requestId)){var index=requests.indexOf(requestId);document.getElementById('wrapper').insertAdjacentHTML('beforeend','<p>Requesting delivery confirmation of requestId '+requestId+'</p>'+'<button onClick=\"window.handleConfirm('+index+')\">Confirm</button>');}};return/*#__PURE__*/_jsxs(\"div\",{id:\"wrapper\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Request a Delivery\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"to\",children:\"Delivery Destination: \"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"to\",onChange:handleInput}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"from\",children:\"Pickup From: \"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"from\",onChange:handleInput}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"item\",children:\"Pick this up: \"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"item\",onChange:handleInput}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"value\",children:\"Attach payment(in wei): \"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"value\",onChange:handleInput}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmit,children:\"Submit\"})]});};export default RequestDelivery;","map":{"version":3,"names":["React","useState","useEth","listeningToAllegeEvent","listeningToAcceptEvent","RequestDelivery","state","contract","accounts","to","setTo","from","setFrom","item","setItem","value","setValue","window","allegeEvent","requests","setRequests","acceptEvent","events","AcceptEvent","on","log","handleAccept","AllegeEvent","handleAllege","handleInput","e","target","name","alert","handleSubmit","methods","requestDelivery","send","then","response","console","tempArray","push","RequestEvent","returnValues","requestId","handleConfirm","index","confirm","includes","deliveryMan","document","getElementById","insertAdjacentHTML","indexOf"],"sources":["D:/Kapil D/Personal/DecentralizedDeliveries/client/src/components/RequestDelivery.jsx"],"sourcesContent":["import React, {useState} from 'react'\r\nimport useEth from \"../contexts/EthContext/useEth\";\r\n\r\nlet listeningToAllegeEvent = false;\r\nlet listeningToAcceptEvent = false;\r\n\r\nconst RequestDelivery = () => {\r\n  const { state: { contract, accounts } } = useEth();\r\n\r\n  const [to, setTo] = useState('')\r\n  const [from, setFrom] = useState('')\r\n  const [item, setItem] = useState('')\r\n  const [value, setValue] = useState(0)\r\n  window.allegeEvent = null;\r\n  const [requests, setRequests] = useState([])\r\n\r\n\r\n  // starting listener for Accept Event.\r\n  if (contract != null && !listeningToAcceptEvent) {\r\n    window.acceptEvent = contract.events.AcceptEvent()\r\n    .on(\"data\", function(log) {\r\n      handleAccept(log);\r\n    })\r\n    listeningToAcceptEvent = true;\r\n  }\r\n\r\n  // starting listener for Allege Event.\r\n  if (contract != null && !listeningToAllegeEvent) {\r\n    window.allegeEvent = contract.events.AllegeEvent()\r\n    .on(\"data\", function(log) {\r\n      handleAllege(log);\r\n    })\r\n    listeningToAllegeEvent = true;\r\n  }\r\n\r\n  const handleInput = e => {\r\n    switch(e.target.name) {\r\n        case 'to': \r\n            setTo(e.target.value);\r\n            break;\r\n        case 'from':\r\n            setFrom(e.target.value);\r\n            break;\r\n        case 'item': \r\n            setItem(e.target.value);\r\n            break;\r\n        case 'value': \r\n            setValue(e.target.value);\r\n            break;\r\n        default: \r\n            alert('Invalid input source.')\r\n            break;\r\n    }\r\n  }\r\n\r\n  const handleSubmit = async () => {\r\n    // Validation: \r\n    if (to === '' || from === '' || item === '' || value === 0) {\r\n        alert(\"Please fill in all the values.\")\r\n        return;\r\n    }\r\n\r\n    // Calling Contract if validation succeeds: \r\n    await contract.methods.requestDelivery(to, from, item).send({from: accounts[0], value: value}).then((response) => {\r\n      console.log(response)\r\n      let tempArray = requests\r\n      tempArray.push(response.events.RequestEvent.returnValues.requestId)\r\n      setRequests(tempArray)\r\n    })\r\n  }\r\n\r\n  window.handleConfirm = async (index) => {\r\n    let requestId = requests[index]\r\n    await contract.methods.confirm(requestId).send({from: accounts[0]})\r\n  }\r\n\r\n  const handleAccept = (log) => {\r\n    let requestId = log.returnValues.requestId\r\n    if (requests.includes(requestId)) {\r\n      let deliveryMan = log.returnValues.deliveryMan\r\n      document.getElementById('wrapper').insertAdjacentHTML('beforeend', \r\n                                                            '<p>Request ' + requestId + ' has been accepted by '+ deliveryMan +'</p>')\r\n    }\r\n  }\r\n\r\n  const handleAllege = (log) => {\r\n    let requestId = log.returnValues.requestId\r\n    if (requests.includes(requestId)) {\r\n      let index = requests.indexOf(requestId)\r\n      document.getElementById('wrapper').insertAdjacentHTML('beforeend', \r\n                                                            '<p>Requesting delivery confirmation of requestId ' + requestId + '</p>' + \r\n                                                            '<button onClick=\"window.handleConfirm('+ index +')\">Confirm</button>')\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div id='wrapper'>\r\n        <h1>Request a Delivery</h1>\r\n        <label htmlFor=\"to\">Delivery Destination: </label>\r\n        <input type=\"text\" name='to' onChange={handleInput}/>\r\n\r\n        <label htmlFor=\"from\">Pickup From: </label>\r\n        <input type=\"text\" name='from' onChange={handleInput}/>\r\n\r\n        <label htmlFor=\"item\">Pick this up: </label>\r\n        <input type=\"text\" name='item' onChange={handleInput} />\r\n\r\n        <label htmlFor=\"value\">Attach payment(in wei): </label>\r\n        <input type=\"number\" name='value' onChange={handleInput} />\r\n\r\n        <button onClick={handleSubmit}>Submit</button>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default RequestDelivery"],"mappings":"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"},"metadata":{},"sourceType":"module"}